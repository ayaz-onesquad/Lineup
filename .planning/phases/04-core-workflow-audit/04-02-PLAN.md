---
phase: 04-core-workflow-audit
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/clients/ClientDetailPage.tsx
  - src/pages/projects/ProjectDetailPage.tsx
  - src/pages/sets/SetDetailPage.tsx
  - src/pages/requirements/RequirementDetailPage.tsx
  - src/pages/contacts/ContactDetailPage.tsx
autonomous: true

must_haves:
  truths:
    - "All detail pages show display_id prominently in header (format: | ID: {display_id})"
    - "All detail pages show AuditTrail component in footer with creator/updater names"
    - "AuditTrail displays user full names and avatars, not just IDs"
  artifacts:
    - path: "src/pages/clients/ClientDetailPage.tsx"
      provides: "Client detail with display_id header and AuditTrail footer"
      contains: "AuditTrail"
    - path: "src/pages/projects/ProjectDetailPage.tsx"
      provides: "Project detail with display_id header and AuditTrail footer"
      contains: "AuditTrail"
    - path: "src/pages/sets/SetDetailPage.tsx"
      provides: "Set detail with display_id header and AuditTrail footer"
      contains: "AuditTrail"
    - path: "src/pages/requirements/RequirementDetailPage.tsx"
      provides: "Requirement detail with display_id header and AuditTrail footer"
      contains: "AuditTrail"
    - path: "src/pages/contacts/ContactDetailPage.tsx"
      provides: "Contact detail with display_id header and AuditTrail footer"
      contains: "AuditTrail"
  key_links:
    - from: "All detail pages"
      to: "src/components/shared/AuditTrail.tsx"
      via: "import { AuditTrail }"
      pattern: "AuditTrail"
---

<objective>
Audit and ensure display_id and AuditTrail are consistently implemented across all major detail pages.

Purpose: Success criteria #5 requires display_id prominence on all record views. Success criteria #6 requires AuditTrail component showing user names on all major record pages.

Output: All 5 core detail pages (Client, Project, Set, Requirement, Contact) have display_id in header and AuditTrail in footer with user names.
</objective>

<execution_context>
@/Users/ayazmohammed/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ayazmohammed/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-core-workflow-audit/04-RESEARCH.md

Pattern reference from ClientDetailPage (already has both):
- Header: `{client.name} | ID: {client.display_id}`
- Footer: `<AuditTrail created_at={} created_by={} updated_at={} updated_by={} creator={} updater={} />`

AuditTrail component expects:
- `creator` and `updater` as UserProfile objects with `full_name` and `avatar_url`
- API queries must join user_profiles for these to work
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit and fix display_id and AuditTrail on all detail pages</name>
  <files>
    src/pages/clients/ClientDetailPage.tsx
    src/pages/projects/ProjectDetailPage.tsx
    src/pages/sets/SetDetailPage.tsx
    src/pages/requirements/RequirementDetailPage.tsx
    src/pages/contacts/ContactDetailPage.tsx
  </files>
  <action>
For each detail page, verify these two patterns exist:

**1. Display ID in Header Pattern:**
```tsx
<h1 className="text-3xl font-bold tracking-tight">
  {entity.name || entity.title}
  {entity.display_id && <span className="text-muted-foreground"> | ID: {entity.display_id}</span>}
</h1>
```

**2. AuditTrail in Footer Pattern:**
At the end of the Details tab content (inside the details Card or section):
```tsx
<div className="mt-6 pt-4 border-t">
  <AuditTrail
    created_at={entity.created_at}
    created_by={entity.created_by}
    updated_at={entity.updated_at}
    updated_by={entity.updated_by}
    creator={entity.creator}
    updater={entity.updater}
  />
</div>
```

**Audit Checklist (read each file and fix if missing):**

- **ClientDetailPage.tsx**: Verified - has both (display_id line 411, AuditTrail line 667)
- **ProjectDetailPage.tsx**: Check and add if missing
- **SetDetailPage.tsx**: Check and add if missing
- **RequirementDetailPage.tsx**: Check and add if missing
- **ContactDetailPage.tsx**: Check and add if missing

For any page missing AuditTrail:
1. Add import: `import { AuditTrail } from '@/components/shared/AuditTrail'`
2. Add component at end of Details tab content

For any page missing display_id in header:
1. Add the span after entity name in h1 element
  </action>
  <verify>
1. Run `npm run build` - should complete without errors
2. For each detail page, visually verify:
   - Header shows "Entity Name | ID: {number}"
   - Footer of Details tab shows "Created: {date} by {name}" and "Last Updated: {date} by {name}"
  </verify>
  <done>All 5 core detail pages (Client, Project, Set, Requirement, Contact) show display_id in header and AuditTrail with user names in footer.</done>
</task>

<task type="auto">
  <name>Task 2: Verify API queries include creator/updater profile joins</name>
  <files>
    src/services/api/clients.ts
    src/services/api/projects.ts
    src/services/api/sets.ts
    src/services/api/requirements.ts
    src/services/api/contacts.ts
  </files>
  <action>
For AuditTrail to show user names, API `getById` queries must include creator/updater profile joins.

**Check each API service's `getById` method for these patterns:**

Option A - Direct joins (if FK exists to user_profiles):
```typescript
.select(`
  *,
  creator:created_by (id, full_name, avatar_url),
  updater:updated_by (id, full_name, avatar_url)
`)
```

Option B - Using database views (preferred if available):
```typescript
.from('entity_with_profiles')  // e.g., sets_with_profiles, requirements_with_profiles
```

**Services to check:**
- `clients.ts` - getById method
- `projects.ts` - getById method
- `sets.ts` - getById method (likely uses sets_with_profiles view)
- `requirements.ts` - getById method (likely uses requirements_with_profiles view)
- `contacts.ts` - getById method

If any getById is missing profile joins, add them. The database views `sets_with_profiles`, `requirements_with_profiles`, `projects_with_profiles` already include creator/updater joins.
  </action>
  <verify>
1. Run `npm run build` - no TypeScript errors
2. Test each detail page - AuditTrail should show "by {Full Name}" not "Unknown" or empty
  </verify>
  <done>All API getById methods include creator/updater profile joins, enabling AuditTrail to display user names.</done>
</task>

</tasks>

<verification>
1. `npm run build` passes without TypeScript errors
2. ClientDetailPage shows display_id and AuditTrail with names
3. ProjectDetailPage shows display_id and AuditTrail with names
4. SetDetailPage shows display_id and AuditTrail with names
5. RequirementDetailPage shows display_id and AuditTrail with names
6. ContactDetailPage shows display_id and AuditTrail with names
</verification>

<success_criteria>
- All 5 core detail pages have display_id prominently in header
- All 5 core detail pages have AuditTrail component in footer
- AuditTrail displays creator/updater names (not just IDs or "Unknown")
- Build completes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-core-workflow-audit/04-02-SUMMARY.md`
</output>
