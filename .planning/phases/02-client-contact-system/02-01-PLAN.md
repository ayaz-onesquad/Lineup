---
phase: 02-client-contact-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/pages/clients/ClientDetailPage.tsx
  - src/hooks/useClients.ts
autonomous: true

must_haves:
  truths:
    - "User can navigate to /clients/:clientId and see client details"
    - "Client detail page loads without 404 or blank screen"
    - "Contacts tab displays existing contacts for the client"
  artifacts:
    - path: "src/pages/clients/ClientDetailPage.tsx"
      provides: "Working client detail page"
      contains: "useParams.*clientId"
    - path: "src/hooks/useClients.ts"
      provides: "Client query hook"
      contains: "useClient"
  key_links:
    - from: "src/pages/clients/ClientsPage.tsx"
      to: "/clients/${client.id}"
      via: "Link navigation"
      pattern: "Link.*to.*clients/"
    - from: "src/pages/clients/ClientDetailPage.tsx"
      to: "useClient hook"
      via: "useParams clientId"
      pattern: "useClient\\(clientId"
---

<objective>
Fix BUG-03: Client detail route loads correctly

Purpose: Users cannot view client details - this blocks all client management workflows. Must diagnose and fix the root cause.
Output: Working /clients/:clientId route that displays client information and contacts
</objective>

<execution_context>
@/Users/ayazmohammed/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ayazmohammed/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-client-contact-system/02-RESEARCH.md

# Key files to investigate
@src/App.tsx
@src/pages/clients/ClientDetailPage.tsx
@src/pages/clients/ClientsPage.tsx
@src/hooks/useClients.ts
@src/services/api/clients.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Diagnose client detail route failure</name>
  <files>src/pages/clients/ClientDetailPage.tsx, src/hooks/useClients.ts, src/App.tsx</files>
  <action>
Investigate why /clients/:clientId fails to load. Check these specific points:

1. **Route configuration** (App.tsx line 90):
   - Verify route path is `/clients/:clientId` (not `/clients/:id`)
   - Verify ClientDetailPage is imported and used correctly

2. **Parameter extraction** (ClientDetailPage.tsx line 99):
   - Verify useParams extracts `clientId` (matching route param name)
   - Add console.log to verify clientId value: `console.log('clientId from params:', clientId)`

3. **Query hook** (useClients.ts line 19-25):
   - Check if `enabled: !!id` condition is working
   - Verify clientsApi.getById is called correctly

4. **API response** (clients.ts line 48-79):
   - Check if query returns data or throws error
   - Verify RLS allows SELECT on clients table

5. **Conditional rendering** (ClientDetailPage.tsx):
   - Check if "not found" is shown incorrectly
   - Verify loading state doesn't cause blank screen

Add debug logging at each step. Run `npm run dev` and test navigation from /clients list to a specific client.

Document the root cause found.
  </action>
  <verify>
Navigate to any client detail page in the browser. Console should show debug logs. Identify exact failure point.
  </verify>
  <done>Root cause of BUG-03 identified and documented</done>
</task>

<task type="auto">
  <name>Task 2: Fix client detail route based on diagnosis</name>
  <files>src/pages/clients/ClientDetailPage.tsx, src/hooks/useClients.ts</files>
  <action>
Based on Task 1 diagnosis, implement the fix. Common fixes by root cause:

**If clientId is undefined:**
- Ensure useParams type matches route: `useParams<{ clientId: string }>()`
- Add null check before using clientId

**If query not running:**
- Check `enabled` condition in useClient hook
- Ensure clientId is truthy before query runs

**If RLS blocks query:**
- Verify tenant_id filter works
- Check user has SELECT permission on clients

**If "not found" shows incorrectly:**
- Fix conditional: only show "not found" when `!isLoading && !client`
- Add proper loading skeleton while fetching

**If contacts query fails:**
- Ensure contacts table exists (already confirmed in research)
- Check contacts query error handling

After fix, remove debug console.logs added in Task 1.

Ensure:
- Loading state shows skeleton, not blank
- Error state shows helpful message
- Client data displays correctly
- Contacts tab loads without errors
  </action>
  <verify>
1. Run `npm run dev`
2. Navigate to /clients
3. Click any client row
4. Verify /clients/:id loads with client details
5. Verify Contacts tab shows contacts (or empty state)
6. Run `npm run build` to confirm no TypeScript errors
  </verify>
  <done>Client detail route loads correctly without 404 or blank screen; contacts tab displays properly</done>
</task>

</tasks>

<verification>
- Navigate to /clients, click a client, page loads with details
- Contacts tab shows contacts for that client
- No console errors during navigation
- `npm run build` passes
</verification>

<success_criteria>
- BUG-03 resolved: /clients/:clientId route works
- Client details display correctly
- Contacts tab functional
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-client-contact-system/02-01-SUMMARY.md`
</output>
