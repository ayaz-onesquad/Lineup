---
phase: 01-foundation-fixes
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - supabase/refresh-schema-cache.sql
autonomous: true

must_haves:
  truths:
    - "PostgREST recognizes location column on clients table"
    - "INSERT operations on clients table with location field succeed"
    - "SELECT queries return location field data"
  artifacts:
    - path: "supabase/refresh-schema-cache.sql"
      provides: "Schema cache refresh script"
      contains: "NOTIFY pgrst"
  key_links:
    - from: "Supabase PostgREST"
      to: "clients.location column"
      via: "schema cache refresh"
      pattern: "NOTIFY pgrst"
---

<objective>
Fix PostgREST schema cache so new columns (location, industry, overview) on clients table are recognized.

Purpose: The clients table was extended with new columns in migration 002, but PostgREST caches the schema. Without refreshing, INSERT/SELECT operations fail with "column does not exist" errors.

Output: A SQL script that refreshes PostgREST schema cache, ready to run in Supabase SQL Editor.
</objective>

<execution_context>
@/Users/ayazmohammed/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ayazmohammed/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@supabase/migrations/002_comprehensive_update.sql
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PostgREST schema cache refresh script</name>
  <files>supabase/refresh-schema-cache.sql</files>
  <action>
Create a SQL script at `supabase/refresh-schema-cache.sql` that:

1. Uses `NOTIFY pgrst, 'reload schema'` to trigger PostgREST schema reload
2. Includes a verification query that selects the new columns from clients table schema
3. Add comments explaining when to use this script (after schema changes)

The script should be idempotent (safe to run multiple times).

Content structure:
```sql
-- Schema Cache Refresh for PostgREST
-- Run this after any schema changes to ensure PostgREST recognizes new columns

-- Notify PostgREST to reload schema cache
NOTIFY pgrst, 'reload schema';

-- Verify clients table has expected columns
SELECT column_name, data_type
FROM information_schema.columns
WHERE table_name = 'clients'
AND column_name IN ('location', 'industry', 'overview', 'display_id', 'updated_by')
ORDER BY column_name;
```
  </action>
  <verify>
File exists at supabase/refresh-schema-cache.sql with NOTIFY command and verification query.
  </verify>
  <done>
Schema refresh script created with idempotent NOTIFY command and column verification query.
  </done>
</task>

<task type="auto">
  <name>Task 2: Document schema refresh in project README or CLAUDE.md</name>
  <files>CLAUDE.md</files>
  <action>
Add a section to CLAUDE.md under "Common Commands" documenting the schema cache refresh process:

Add this content:
```markdown
- Schema cache refresh: After DB migrations, run `supabase/refresh-schema-cache.sql` in Supabase SQL Editor
```

This ensures future developers know to refresh the cache after schema changes.
  </action>
  <verify>
CLAUDE.md contains the schema cache refresh documentation under Common Commands.
  </verify>
  <done>
Schema cache refresh process documented in CLAUDE.md.
  </done>
</task>

</tasks>

<verification>
1. supabase/refresh-schema-cache.sql exists with NOTIFY pgrst command
2. CLAUDE.md updated with schema cache refresh documentation
3. Files are syntactically valid SQL
</verification>

<success_criteria>
- Schema refresh script ready for execution in Supabase SQL Editor
- Documentation added so future schema changes include cache refresh step
- BUG-01 fix is prepared (user will run the SQL script manually in Supabase)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-fixes/01-01-SUMMARY.md`
</output>
