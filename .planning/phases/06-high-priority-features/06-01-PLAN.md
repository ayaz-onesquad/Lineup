# Plan 06-01: Template Creation Finalization

## Goal

Add "Save as Template" button to ProjectDetailPage so users can create templates from existing projects.

## Current State

- TemplatesPage (`/templates`) exists and shows templates
- `projectsApi.saveAsTemplate(projectId, templateName)` works
- `useProjectMutations().saveAsTemplate` hook exists
- **MISSING:** UI button and dialog on ProjectDetailPage

## Tasks

### Task 1: Create SaveAsTemplateDialog Component
- [ ] Create `src/components/projects/SaveAsTemplateDialog.tsx`
- [ ] Fields: Template Name (required), Description (optional)
- [ ] Options checkboxes: Include phases, Include sets, Clear dates, Clear assignments
- [ ] Confirm/Cancel buttons with loading state

### Task 2: Add Actions Menu to ProjectDetailPage
- [ ] Add dropdown menu (three-dots) next to Edit button in header
- [ ] Menu items: "Save as Template", "Duplicate Project", "Delete Project"
- [ ] Wire "Save as Template" to open dialog

### Task 3: Wire Dialog to Mutation
- [ ] On confirm, call `saveAsTemplate.mutateAsync()`
- [ ] Show success toast with link to templates page
- [ ] Close dialog on success
- [ ] Handle errors with appropriate messages

### Task 4: Update TemplatesPage Info
- [ ] Remove confusing "Save Project as Template" button that navigates to /projects
- [ ] Update info card text to reflect the actual workflow

## Implementation

### SaveAsTemplateDialog.tsx

```typescript
interface SaveAsTemplateDialogProps {
  projectId: string
  projectName: string
  open: boolean
  onOpenChange: (open: boolean) => void
}

export function SaveAsTemplateDialog({
  projectId,
  projectName,
  open,
  onOpenChange,
}: SaveAsTemplateDialogProps) {
  const [templateName, setTemplateName] = useState(`${projectName} Template`)
  const { saveAsTemplate } = useProjectMutations()

  const handleSave = async () => {
    try {
      await saveAsTemplate.mutateAsync({
        projectId,
        templateName,
        options: {
          include_children: true,
          clear_dates: true,
          clear_assignments: true,
        },
      })
      toast.success('Template created successfully!')
      onOpenChange(false)
    } catch (error) {
      toast.error('Failed to create template')
    }
  }

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent>
        <DialogHeader>
          <DialogTitle>Save as Template</DialogTitle>
          <DialogDescription>
            Create a reusable template from "{projectName}"
          </DialogDescription>
        </DialogHeader>

        <div className="space-y-4">
          <div>
            <Label htmlFor="templateName">Template Name</Label>
            <Input
              id="templateName"
              value={templateName}
              onChange={(e) => setTemplateName(e.target.value)}
              placeholder="Enter template name"
            />
          </div>

          <p className="text-sm text-muted-foreground">
            The template will include all phases, sets, pitches, and requirements.
            Dates and team assignments will be cleared.
          </p>
        </div>

        <DialogFooter>
          <Button variant="outline" onClick={() => onOpenChange(false)}>
            Cancel
          </Button>
          <Button
            onClick={handleSave}
            disabled={!templateName.trim() || saveAsTemplate.isPending}
          >
            {saveAsTemplate.isPending ? 'Creating...' : 'Create Template'}
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  )
}
```

### ProjectDetailPage.tsx Changes

```typescript
// Add to imports
import { SaveAsTemplateDialog } from '@/components/projects/SaveAsTemplateDialog'
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu'
import { MoreHorizontal } from 'lucide-react'

// Add state
const [saveTemplateOpen, setSaveTemplateOpen] = useState(false)

// Add to header actions (next to Edit button)
<DropdownMenu>
  <DropdownMenuTrigger asChild>
    <Button variant="outline" size="icon">
      <MoreHorizontal className="h-4 w-4" />
    </Button>
  </DropdownMenuTrigger>
  <DropdownMenuContent align="end">
    <DropdownMenuItem onClick={() => setSaveTemplateOpen(true)}>
      Save as Template
    </DropdownMenuItem>
    <DropdownMenuItem onClick={() => {/* duplicate logic */}}>
      Duplicate Project
    </DropdownMenuItem>
    <DropdownMenuSeparator />
    <DropdownMenuItem className="text-destructive">
      Delete Project
    </DropdownMenuItem>
  </DropdownMenuContent>
</DropdownMenu>

{/* Dialog */}
<SaveAsTemplateDialog
  projectId={project.id}
  projectName={project.name}
  open={saveTemplateOpen}
  onOpenChange={setSaveTemplateOpen}
/>
```

## Verification

- [ ] "Save as Template" appears in ProjectDetailPage actions menu
- [ ] Dialog opens with project name pre-filled
- [ ] Saving creates template (visible in TemplatesPage)
- [ ] Template can be used to create new project
- [ ] Error handling works for invalid names

## Estimated Effort

Small - 2-3 hours
