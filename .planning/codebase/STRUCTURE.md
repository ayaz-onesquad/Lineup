# Codebase Structure

**Analysis Date:** 2026-02-05

## Directory Layout

```
/Users/ayazmohammed/LineUp/
├── src/
│   ├── App.tsx                 # Root routing component (React Router setup)
│   ├── main.tsx                # React DOM mount point
│   ├── index.css               # Global styles + Tailwind directives
│   │
│   ├── components/             # Reusable UI components
│   │   ├── ui/                 # shadcn/ui primitives
│   │   ├── layouts/            # Page layouts (MainLayout, AuthLayout, etc.)
│   │   ├── forms/              # Domain forms (ClientForm, ProjectForm, etc.)
│   │   ├── details/            # Summary detail cards (read-only)
│   │   ├── guards/             # Route guards (AuthGuard, TenantGuard, AdminGuard)
│   │   ├── providers/          # Context providers (AuthProvider)
│   │   ├── navigation/         # Header/sidebar (TopNav, Sidebar)
│   │   └── shared/             # Reusable business components (AuditTrail, CreateModal)
│   │
│   ├── pages/                  # Route-mounted full-page components
│   │   ├── auth/               # Authentication pages (LoginPage, SignUpPage, OnboardingPage)
│   │   ├── dashboard/          # Main dashboard
│   │   ├── clients/            # Client list & detail pages
│   │   ├── projects/           # Project list & detail pages
│   │   ├── sets/               # Set list page
│   │   ├── requirements/       # Requirement list page
│   │   ├── settings/           # Settings & team management pages
│   │   ├── portal/             # Client portal pages (PortalDashboardPage, PortalProjectPage)
│   │   └── admin/              # System admin pages (AdminDashboardPage, AdminTenantDetailPage)
│   │
│   ├── hooks/                  # Custom React hooks (data + business logic)
│   │   ├── useAuth.ts          # Authentication mutations
│   │   ├── useUserRole.ts      # Fetch current user's highest role (source of truth for RBAC)
│   │   ├── useTenant.ts        # Tenant context & switching
│   │   ├── useClients.ts       # Client queries & mutations
│   │   ├── useProjects.ts      # Project queries & mutations
│   │   ├── useSets.ts          # Set queries & mutations
│   │   ├── useRequirements.ts  # Requirement queries & mutations
│   │   ├── useContacts.ts      # Contact queries & mutations
│   │   ├── use-toast.ts        # Toast notifications (shadcn/ui)
│   │   └── index.ts            # Barrel exports
│   │
│   ├── services/               # External service integrations
│   │   ├── supabase.ts         # Supabase client initialization
│   │   └── api/                # Database API layer
│   │       ├── auth.ts         # Auth-related API calls
│   │       ├── clients.ts      # Client CRUD + helper queries
│   │       ├── contacts.ts     # Contact CRUD
│   │       ├── projects.ts     # Project CRUD + child relations
│   │       ├── phases.ts       # Phase CRUD
│   │       ├── sets.ts         # Set CRUD
│   │       ├── requirements.ts # Requirement CRUD
│   │       ├── documents.ts    # Document management
│   │       ├── discussions.ts  # Discussion/comments
│   │       ├── statusUpdates.ts# Status tracking
│   │       ├── tenants.ts      # Tenant management
│   │       └── index.ts        # Barrel exports
│   │
│   ├── stores/                 # Zustand state management
│   │   ├── authStore.ts        # User session + profile state (persisted)
│   │   ├── tenantStore.ts      # Current tenant + tenant list (persisted)
│   │   ├── uiStore.ts          # UI state (sidebar, panels, modals)
│   │   └── index.ts            # Barrel exports
│   │
│   ├── types/                  # TypeScript types & interfaces
│   │   └── database.ts         # All database entity types
│   │
│   ├── lib/                    # Utility functions
│   │   └── utils.ts            # Formatters, color helpers, Eisenhower priority logic, cn()
│   │
│   └── assets/                 # Static assets (images, icons if local)
│
├── supabase/                   # Supabase migrations & functions
│   └── migrations/             # Database schema migrations
│
├── public/                     # Static HTML assets
├── dist/                       # Build output (generated)
├── node_modules/               # Dependencies (generated)
│
├── package.json                # Project dependencies & scripts
├── tsconfig.json               # TypeScript root config
├── tsconfig.app.json           # App TypeScript config (target: ES2022, jsx: react-jsx)
├── tsconfig.node.json          # Build tool TypeScript config
├── vite.config.ts              # Vite config with @ alias to src/
├── eslint.config.js            # ESLint configuration
├── tailwind.config.js          # Tailwind CSS config
├── postcss.config.js           # PostCSS (for Tailwind)
├── index.html                  # HTML root template
│
└── .planning/codebase/         # Analysis documents (generated by GSD)
    ├── STACK.md
    ├── INTEGRATIONS.md
    ├── CONVENTIONS.md
    ├── TESTING.md
    └── ARCHITECTURE.md / STRUCTURE.md (these files)
```

## Directory Purposes

**`src/components/ui/`**
- Purpose: Unstyled shadcn/ui component library
- Contains: Button, Card, Dialog, Form, Input, Select, Table, Tabs, Badge, etc.
- Key files: All .tsx files are direct copies from shadcn/ui with Radix UI dependencies
- Usage: Imported into pages, forms, and detail components

**`src/components/layouts/`**
- Purpose: Page-level layout shells
- Key files:
  - `MainLayout.tsx`: App shell with Sidebar + TopNav + main content area + DetailPanel
  - `AuthLayout.tsx`: Centered layout for login/signup
  - `PortalLayout.tsx`: Client portal layout
  - `AdminLayout.tsx`: Admin portal layout

**`src/components/forms/`**
- Purpose: Domain-specific forms for create/edit operations
- Key files:
  - `ClientForm.tsx`: Client details form (name, company, industry, portal settings)
  - `ProjectForm.tsx`: Project form
  - `SetForm.tsx`: Set form
  - `RequirementForm.tsx`: Requirement form (complex, includes Eisenhower priority)
  - `PhaseForm.tsx`: Phase form (minimal)
- Pattern: All use React Hook Form + Zod validation, return `<Form>` component

**`src/components/details/`**
- Purpose: Read-only summary cards for quick viewing
- Key files:
  - `ClientDetail.tsx`: Shows client summary (name, company, primary contact)
  - `ProjectDetail.tsx`: Project summary
  - `SetDetail.tsx`: Set summary
  - `RequirementDetail.tsx`: Requirement summary
- Pattern: Single `<Card>` with formatted data, no interaction

**`src/components/guards/`**
- Purpose: Route protection middleware
- Key files:
  - `AuthGuard.tsx`: Checks authentication + role; redirects to login/onboarding/admin as needed
  - `TenantGuard.tsx`: Ensures currentTenant is set
  - `AdminGuard.tsx`: Restricts to `sys_admin` role only
- Pattern: Wraps routes in App.tsx; shows spinner while loading; redirects on permission fail

**`src/pages/auth/`**
- Purpose: Unauthenticated user flows
- Key files:
  - `LoginPage.tsx`: Email/password login
  - `SignUpPage.tsx`: Email/password registration
  - `ForgotPasswordPage.tsx`: Password reset request
  - `OnboardingPage.tsx`: First-time tenant setup (creates tenant + assigns user as org_admin)

**`src/pages/{clients,projects,sets,requirements}/`**
- Purpose: Full-page views for each entity
- Key files:
  - `ClientsPage.tsx`: List view of clients (searchable table)
  - `ClientDetailPage.tsx`: Detail view with View/Edit modes, nested contacts
  - `ProjectsPage.tsx`: List view of projects
  - `ProjectDetailPage.tsx`: Detail view with nested phases/sets
  - `RequirementsPage.tsx`: List of all requirements (filtered by tenant)
  - `SetsPage.tsx`: List of sets
- Pattern: All detail pages follow View/Edit mode pattern with tabs

**`src/hooks/`**
- Purpose: React hooks for queries, mutations, and context
- Naming: `use[Entity]()`
- Pattern examples:
  - `useClients()` - TanStack Query with auto tenantId injection
  - `useClientMutations()` - Returns create/update/delete mutations
  - `useUserRole()` - Fetches highest role via RPC (source of truth for routing)
  - `useTenant()` - Fetches tenants for current user

**`src/services/api/`**
- Purpose: Supabase database queries
- One file per entity
- Pattern: Each file exports a namespace object with CRUD methods
- Example file structure:
  ```typescript
  // src/services/api/clients.ts
  export const clientsApi = {
    getAll: async (tenantId: string) => { ... },
    getById: async (id: string) => { ... },
    create: async (tenantId: string, userId: string, input) => { ... },
    update: async (id: string, userId: string, input) => { ... },
    delete: async (id: string) => { ... },
  }
  ```
- All queries filter: `.eq('tenant_id', tenantId).is('deleted_at', null)`

**`src/stores/`**
- Purpose: Client-side state with Zustand
- Key stores:
  - `authStore.ts`: user, profile, role, isLoading, setters + logout
  - `tenantStore.ts`: currentTenant, tenants list, tenantUsers, switchTenant()
  - `uiStore.ts`: sidebarCollapsed, detailPanel.isOpen, createModal state
- All use `persist` middleware to retain state across page reloads

**`src/lib/utils.ts`**
- Purpose: Utility functions
- Functions:
  - `cn()`: Tailwind class merge (clsx + twMerge)
  - `formatDate()`, `formatDateTime()`: Date formatting
  - `generateSlug()`: URL-safe slugs
  - `getInitials()`: Avatar initials
  - `getStatusColor()`, `getHealthColor()`: Tailwind color classes for status badges
  - `calculateEisenhowerPriority()`: Priority logic (1-6 based on Urgency + Importance)

**`src/types/database.ts`**
- Purpose: All TypeScript interfaces matching Supabase schema
- Entities: User, UserProfile, Tenant, Client, Contact, Project, Phase, Set, Requirement, etc.
- Pattern: Interfaces for base entity + "_WithRelations" variants for nested data

## Key File Locations

**Entry Points:**
- `src/main.tsx`: React app mount point
- `src/App.tsx`: React Router root + provider setup

**Configuration:**
- `vite.config.ts`: Build config (@ alias, React plugin)
- `tsconfig.app.json`: TypeScript compilation (target ES2022, jsx react-jsx)
- `eslint.config.js`: Linting rules
- `tailwind.config.js`: Tailwind theme
- `postcss.config.js`: PostCSS for Tailwind

**Core Logic:**
- `src/services/supabase.ts`: Supabase client
- `src/hooks/useUserRole.ts`: RBAC source of truth
- `src/components/guards/AuthGuard.tsx`: Route protection logic
- `src/components/providers/AuthProvider.tsx`: Supabase session setup
- `src/stores/authStore.ts`, `tenantStore.ts`: State management

**Testing:**
- Not present (no test files found)

## Naming Conventions

**Files:**
- Components: PascalCase + `.tsx` (e.g., `ClientDetailPage.tsx`, `ClientForm.tsx`)
- Services/API: camelCase + `.ts` (e.g., `clients.ts`, `projects.ts`)
- Hooks: `use` prefix + camelCase + `.ts` (e.g., `useClients.ts`, `useUserRole.ts`)
- Stores: camelCase + `Store.ts` (e.g., `authStore.ts`)
- Types: camelCase + `.ts` (e.g., `database.ts`)
- Pages: PascalCase + `Page.tsx` (e.g., `ClientsPage.tsx`, `ClientDetailPage.tsx`)
- Utilities: camelCase + `.ts` (e.g., `utils.ts`)

**Directories:**
- Feature directories (pages): kebab-case (e.g., `clients/`, `projects/`, `auth/`)
- Component categories: kebab-case (e.g., `ui/`, `layouts/`, `guards/`)
- Service categories: camelCase (e.g., `api/`)

**Exports:**
- Page components: Named export `export function [PageName]()`
- API services: Named export `export const [entityName]Api = { ... }`
- Hooks: Named export `export function use[Entity]()`
- Stores: Named export `export const use[Entity]Store = create(...)`
- UI components: Named export `export function [ComponentName]()`

## Where to Add New Code

**New Feature (e.g., NewEntity CRUD):**

1. **Database first (Supabase migrations):**
   - Create migration in `supabase/migrations/` with table + RLS policies
   - Schema: `id (uuid)`, `display_id (auto-increment)`, `tenant_id`, `created_by`, `updated_by`, `created_at`, `updated_at`, `deleted_at`, plus entity fields

2. **Types:**
   - Add interface to `src/types/database.ts`
   - Example: `NewEntity`, `CreateNewEntityInput`, `UpdateNewEntityInput`

3. **API Service:**
   - Create `src/services/api/newEntities.ts` with CRUD methods
   - Follow pattern: `getAll()`, `getById()`, `create()`, `update()`, `delete()`, `restore()`

4. **Hooks:**
   - Create `src/hooks/useNewEntities.ts`
   - Export read hook: `useNewEntities()` with auto tenantId
   - Export mutation hook: `useNewEntityMutations()` with create/update/delete
   - Add to `src/hooks/index.ts`

5. **Pages:**
   - Create `src/pages/newEntities/` directory
   - `NewEntitiesPage.tsx`: List view (table/grid)
   - `NewEntityDetailPage.tsx`: Detail view with View/Edit modes

6. **Components:**
   - Form: `src/components/forms/NewEntityForm.tsx` (React Hook Form + Zod)
   - Detail: `src/components/details/NewEntityDetail.tsx` (read-only card)

7. **Routing:**
   - Add routes to `src/App.tsx` under TenantGuard section
   - Example: `<Route path="/new-entities" element={<NewEntitiesPage />} />`
   - Example: `<Route path="/new-entities/:newEntityId" element={<NewEntityDetailPage />} />`

**New Component/Module:**
- Implementation: `src/components/[category]/[ComponentName].tsx`
- Naming: PascalCase + `.tsx`
- If reusable across pages: place in `src/components/shared/`
- If specific to a feature: place in feature's `src/pages/[feature]/` or in `src/components/[category]/`

**New Utility Function:**
- Shared helpers: `src/lib/utils.ts`
- Feature-specific: Create `src/lib/[featureName]Utils.ts`

**New Page/Route:**
- Location: `src/pages/[feature]/[PageName]Page.tsx`
- Naming: `[EntityName][Purpose]Page.tsx` (e.g., ClientsPage.tsx, ClientDetailPage.tsx)
- Follow View/Edit mode pattern if detail page

## Special Directories

**`src/components/ui/`**
- Purpose: shadcn/ui component library
- Generated: No (manually imported from shadcn)
- Committed: Yes
- Editing: Only customize Tailwind classes, don't change component structure

**`dist/`**
- Purpose: Production build output
- Generated: Yes (`npm run build`)
- Committed: No (.gitignore)

**`supabase/migrations/`**
- Purpose: Database schema versioning
- Generated: Yes (via `supabase migration new`)
- Committed: Yes (source of truth for schema)

**`node_modules/`**
- Purpose: Installed dependencies
- Generated: Yes (npm install)
- Committed: No

**`.planning/codebase/`**
- Purpose: GSD analysis documents
- Generated: Yes (by `/gsd:map-codebase`)
- Committed: Varies (add to git if desired for team reference)

## Import Path Aliases

**Configured in `tsconfig.app.json` and `vite.config.ts`:**
- `@/*` → `src/*`

**Usage:**
```typescript
import { Button } from '@/components/ui/button'
import { useClients } from '@/hooks'
import { clientsApi } from '@/services/api'
import type { Client } from '@/types/database'
```

**Always use `@/` for imports from src/; never use relative paths.**

---

*Structure analysis: 2026-02-05*
